import os
import streamlit as st
from langchain_openai import ChatOpenAI
from langchain.schema import HumanMessage
from langchain.callbacks.base import BaseCallbackHandler
import PyPDF2
import docx
from io import BytesIO

# Page configuration
st.set_page_config(
    page_title="Research Paper Translator - Sutra LLM",
    page_icon="ЁЯУЪ",
    layout="wide"
)

# Define supported languages
languages = [
    "English", "Hindi", "Gujarati", "Bengali", "Tamil", 
    "Telugu", "Kannada", "Malayalam", "Punjabi", "Marathi", 
    "Urdu", "Assamese", "Odia", "Sanskrit", "Korean", 
    "Japanese", "Arabic", "French", "German", "Spanish", 
    "Portuguese", "Russian", "Chinese", "Vietnamese", "Thai", 
    "Indonesian", "Turkish", "Polish", "Ukrainian", "Dutch", 
    "Italian", "Greek", "Hebrew", "Persian", "Swedish", 
    "Norwegian", "Danish", "Finnish", "Czech", "Hungarian", 
    "Romanian", "Bulgarian", "Croatian", "Serbian", "Slovak", 
    "Slovenian", "Estonian", "Latvian", "Lithuanian", "Malay", 
    "Tagalog", "Swahili"
]

# Translation instructions for each language
translation_instructions = {
    "English": "Translate the following research paper into English. The translation should be clear, accurate, and maintain scientific terminology. Preserve the headings, subheadings, and paragraph structure.",
    "Hindi": "рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢реЛрдз рдкрддреНрд░ рдХреЛ рд╣рд┐рдВрджреА рдореЗрдВ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд░реЗрдВред рдЕрдиреБрд╡рд╛рдж рд╕реНрдкрд╖реНрдЯ, рд╕рдЯреАрдХ рдФрд░ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рд╢рдмреНрджрд╛рд╡рд▓реА рдХреЗ рд╕рд╛рде рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рд╣реЗрдбрд┐рдВрдЧ, рдЙрдкрд╢реАрд░реНрд╖рдХ рдФрд░ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдмрдирд╛рдП рд░рдЦреЗрдВред",
    "Gujarati": "ркирлАркЪрлЗ ркЖрккрлЗрк▓рк╛ рк╕ркВрк╢рлЛркзрки рккрлЗрккрк░ркирлБркВ ркЧрлБркЬрк░рк╛ркдрлАркорк╛ркВ ркЕркирлБрк╡рк╛ркж ркХрк░рлЛ. ркЕркирлБрк╡рк╛ркж рк╕рлНрккрк╖рлНркЯ, ркЪрлЛркХрлНркХрк╕ ркЕркирлЗ рк╡рлИркЬрлНркЮрк╛ркирк┐ркХ рк╢ркмрлНркжрк╛рк╡рк▓рлА рк╕рк╛ркерлЗ рк╣рлЛрк╡рлЛ ркЬрлЛркИркП. рк╣рлЗркбрк┐ркВркЧ, рк╕ркмрк╣рлЗркбрк┐ркВркЧ ркЕркирлЗ рккрлЗрк░рк╛ркЧрлНрк░рк╛ркл рк╕рлНркЯрлНрк░ркХрлНркЪрк░ ркЬрк╛рк│рк╡рлА рк░рк╛ркЦрлЛ.",
    "Bengali": "ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд ржЧржмрзЗрж╖ржгрж╛ ржкрзЗржкрж╛рж░ржЯрж┐ ржмрж╛ржВрж▓рж╛ржпрж╝ ржЕржирзБржмрж╛ржж ржХрж░рзБржиред ржЕржирзБржмрж╛ржжржЯрж┐ рж╕рзНржкрж╖рзНржЯ, рж╕ржарж┐ржХ ржПржмржВ ржмрзИржЬрзНржЮрж╛ржирж┐ржХ рж╢ржмрзНржжржнрж╛ржгрзНржбрж╛рж░ржпрзБржХрзНржд рж╣рждрзЗ рж╣ржмрзЗред рж╢рж┐рж░рзЛржирж╛ржо, ржЙржкрж╢рзАрж░рзНрж╖ржХ ржПржмржВ ржЕржирзБржЪрзНржЫрзЗржжрзЗрж░ ржХрж╛ржарж╛ржорзЛ ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрзБржиред",
    "Tamil": "рокро┐ройрпНро╡ро░рпБроорпН роЖро░ро╛ропрпНроЪрпНроЪро┐ роХроЯрпНроЯрпБро░рпИропрпИ родрооро┐ро┤ро┐ро▓рпН роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХро╡рпБроорпН. роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ родрпЖро│ро┐ро╡ро╛роХ, родрпБро▓рпНро▓ро┐ропрооро╛роХ, роЕро▒ро┐ро╡ро┐ропро▓рпН роХро▓рпИроЪрпНроЪрпКро▒рпНроХро│рпБроЯройрпН роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН. родро▓рпИрокрпНрокрпБроХро│рпН, родрпБрогрпИродрпНродро▓рпИрокрпНрокрпБроХро│рпН рооро▒рпНро▒рпБроорпН рокродрпНродро┐ роХроЯрпНроЯроорпИрокрпНрокрпИ рокро░ро╛рооро░ро┐роХрпНроХро╡рпБроорпН.",
    "Telugu": "р░Хр░┐р░Вр░жр░┐ р░кр░░р░┐р░╢р▒Лр░зр░ир░╛ р░кр░др▒Нр░░р░╛р░ир▒Нр░ир░┐ р░др▒Жр░▓р▒Бр░Чр▒Бр░▓р▒Лр░Хр░┐ р░Ер░ир▒Бр░╡р░жр░┐р░Вр░Ър░Вр░бр░┐. р░Ер░ир▒Бр░╡р░╛р░жр░В р░╕р▒Нр░кр░╖р▒Нр░Яр░Вр░Чр░╛, р░Цр░Ър▒Нр░Ър░┐р░др░Вр░Чр░╛ р░ор░░р░┐р░пр▒Б р░╢р░╛р░╕р▒Нр░др▒Нр░░р▒Ар░п р░кр░жр░Ьр░╛р░▓р░Вр░др▒Л р░Йр░Вр░бр░╛р░▓р░┐. р░╢р▒Ар░░р▒Нр░╖р░┐р░Хр░▓р▒Б, р░Йр░кр░╢р▒Ар░░р▒Нр░╖р░┐р░Хр░▓р▒Б р░ор░░р░┐р░пр▒Б р░кр▒Зр░░р░╛ р░ир░┐р░░р▒Нр░ор░╛р░гр░╛р░ир▒Нр░ир░┐ р░ир░┐р░░р▒Нр░╡р░╣р░┐р░Вр░Ър░Вр░бр░┐.",
    "Kannada": "р▓Хр│Жр▓│р▓Чр▓┐р▓и р▓╕р▓Вр▓╢р│Лр▓зр▓ир▓╛ р▓кр▓др│Нр▓░р▓╡р▓ир│Нр▓ир│Б р▓Хр▓ир│Нр▓ир▓бр▓Хр│Нр▓Хр│Ж р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓┐р▓╕р▓┐. р▓Ер▓ир│Бр▓╡р▓╛р▓жр▓╡р│Б р▓╕р│Нр▓кр▓╖р│Нр▓Яр▓╡р▓╛р▓Чр▓┐, р▓ир▓┐р▓Цр▓░р▓╡р▓╛р▓Чр▓┐ р▓ор▓др│Нр▓др│Б р▓╡р│Ир▓Ьр│Нр▓Юр▓╛р▓ир▓┐р▓Х р▓кр▓жр▓╛р▓╡р▓│р▓┐р▓пр│Кр▓Вр▓жр▓┐р▓Чр│Ж р▓Зр▓░р▓мр│Зр▓Хр│Б. р▓╢р│Ар▓░р│Нр▓╖р▓┐р▓Хр│Жр▓Чр▓│р│Б, р▓Йр▓кр▓╢р│Ар▓░р│Нр▓╖р▓┐р▓Хр│Жр▓Чр▓│р│Б р▓ор▓др│Нр▓др│Б р▓кр│Нр▓пр▓╛р▓░р▓╛р▓Чр│Нр▓░р▓╛р▓лр│Н р▓░р▓Ър▓ир│Жр▓пр▓ир│Нр▓ир│Б р▓Хр▓╛р▓пр│Нр▓жр│Бр▓Хр│Кр▓│р│Нр▓│р▓┐.",
    "Malayalam": "р┤др┤╛р┤┤р╡Ж р┤кр┤▒р┤пр╡Бр┤ир╡Нр┤и р┤Чр┤╡р╡Зр┤╖р┤г р┤кр╡Нр┤░р┤мр┤ир╡Нр┤зр┤В р┤ор┤▓р┤пр┤╛р┤│р┤др╡Нр┤др┤┐р┤▓р╡Зр┤Хр╡Нр┤Хр╡Н р┤╡р┤┐р┤╡р╡╝р┤др╡Нр┤др┤ир┤В р┤Ър╡Жр┤пр╡Нр┤пр╡Бр┤Х. р┤╡р┤┐р┤╡р╡╝р┤др╡Нр┤др┤ир┤В р┤╡р╡Нр┤пр┤Хр╡Нр┤др┤╡р╡Бр┤В р┤Хр╡Гр┤др╡Нр┤пр┤╡р╡Бр┤В р┤╢р┤╛р┤╕р╡Нр┤др╡Нр┤░р╡Ар┤п р┤кр┤жр┤╛р┤╡р┤▓р┤┐ р┤Йр╡╛р┤Хр╡Нр┤Хр╡Кр┤│р╡Нр┤│р╡Бр┤ир╡Нр┤ир┤др╡Бр┤В р┤Жр┤пр┤┐р┤░р┤┐р┤Хр╡Нр┤Хр┤гр┤В. р┤др┤▓р┤Хр╡Нр┤Хр╡Жр┤Яр╡Нр┤Яр╡Бр┤Хр╡╛, р┤Йр┤кр┤др┤▓р┤Хр╡Нр┤Хр╡Жр┤Яр╡Нр┤Яр╡Бр┤Хр╡╛, р┤Цр┤гр╡Нр┤бр┤┐р┤Хр┤Хр┤│р╡Бр┤Яр╡Ж р┤Шр┤Яр┤и р┤Ор┤ир╡Нр┤ир┤┐р┤╡ р┤ир┤┐р┤▓р┤ир┤┐р╡╝р┤др╡Нр┤др╡Бр┤Х.",
    "Punjabi": "ри╣рйЗриари╛риВ рижри┐рй▒ридрйЗ риЦрйЛриЬ рикрйЗрикри░ рижри╛ рикрй░риЬри╛римрйА ри╡ри┐рй▒риЪ риЕриирйБри╡ри╛риж риХри░рйЛред риЕриирйБри╡ри╛риж ри╕рикри╕ри╝риЯ, ри╕ри╣рйА риЕридрйЗ ри╡ри┐риЧри┐риЖриириХ ри╕ри╝римрижри╛ри╡ри▓рйА рижрйЗ риири╛ри▓ ри╣рйЛригри╛ риЪри╛ри╣рйАрижри╛ ри╣рйИред ри╕ри┐ри░ри▓рйЗриЦ, риЙрик-ри╕ри┐ри░ри▓рйЗриЦ риЕридрйЗ рикрйИри░ри╛риЧрйНри░ри╛рил ри╕рй░ри░риЪриири╛ риирйВрй░ римри░риХри░ри╛ри░ ри░рй▒риЦрйЛред",
    "Marathi": "рдЦрд╛рд▓реАрд▓ рд╕рдВрд╢реЛрдзрди рдкреЗрдкрд░рдЪреЗ рдорд░рд╛рдареАрдд рднрд╛рд╖рд╛рдВрддрд░ рдХрд░рд╛. рднрд╛рд╖рд╛рдВрддрд░ рд╕реНрдкрд╖реНрдЯ, рдЕрдЪреВрдХ рдЖрдгрд┐ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХ рд╢рдмреНрджрд╛рд╡рд▓реАрд╕рд╣ рдЕрд╕рд╛рд╡реЗ. рд╢реАрд░реНрд╖рдХреЗ, рдЙрдкрд╢реАрд░реНрд╖рдХреЗ рдЖрдгрд┐ рдкрд░рд┐рдЪреНрдЫреЗрдж рд╕рдВрд░рдЪрдирд╛ рдХрд╛рдпрдо рдареЗрд╡рд╛.",
    "Urdu": "┘Е┘Ж╪п╪▒╪м█Б ╪░█М┘Д ╪к╪н┘В█М┘В█М ┘Е┘В╪з┘Д█Т ┌й╪з ╪з╪▒╪п┘И ┘Е█М┌║ ╪к╪▒╪м┘Е█Б ┌й╪▒█М┌║█Ф ╪к╪▒╪м┘Е█Б ┘И╪з╪╢╪н╪М ╪п╪▒╪│╪к ╪з┘И╪▒ ╪│╪з╪ж┘Ж╪│█М ╪з╪╡╪╖┘Д╪з╪н╪з╪к ┌й█Т ╪│╪з╪к┌╛ █Б┘И┘Ж╪з ┌Ж╪з█Б█М█Т█Ф ╪╣┘Ж┘И╪з┘Ж╪з╪к╪М ╪░█М┘Д█М ╪╣┘Ж┘И╪з┘Ж╪з╪к ╪з┘И╪▒ ┘╛█М╪▒╪з┌п╪▒╪з┘Б ┌й█М ╪│╪з╪о╪к ┌й┘И ╪и╪▒┘В╪▒╪з╪▒ ╪▒┌й┌╛█М┌║█Ф",
    "Assamese": "ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд ржЧрз▒рзЗрж╖ржгрж╛ ржкрждрзНрз░ржЯрзЛ ржЕрж╕ржорзАржпрж╝рж╛ржд ржЕржирзБржмрж╛ржж ржХрз░ржХред ржЕржирзБржмрж╛ржжржЯрзЛ рж╕рзНржкрж╖рзНржЯ, рж╕ржарж┐ржХ ржЖрз░рзБ ржмрзИржЬрзНржЮрж╛ржирж┐ржХ рж╢ржмрзНржжржнрж╛ржгрзНржбрж╛рз░рз░ рж╕рзИрждрзЗ рж╣'ржм рж▓рж╛ржЧрж┐ржмред рж╢рж┐рз░рзЛржирж╛ржо, ржЙржкрж╢рзАрз░рзНрж╖ржХ ржЖрз░рзБ ржЕржирзБржЪрзНржЫрзЗржжрз░ ржЧрж╛ржБржержирж┐ ржмржЬрж╛ржЗ рз░рж╛ржЦржХред",
    "Odia": "рмирм┐рморнНрмирм▓рм┐рмЦрм┐рмд рмЧрммрнЗрм╖рмгрм╛ рмкрмдрнНрм░рмХрнБ рмУрмбрм╝рм┐рмЖрм░рнЗ рмЕрмирнБрммрм╛рмж рмХрм░рмирнНрмдрнБред рмЕрмирнБрммрм╛рмжрмЯрм┐ рм╕рнНрмкрм╖рнНрмЯ, рм╕рмарм┐рмХрнН рмПрммрмВ рммрнИрмЬрнНрмЮрм╛рмирм┐рмХ рм╢рммрнНрмжрм╛рммрм│рнА рм╕рм╣рм┐рмд рм╣рнЗрммрм╛ рмЙрмЪрм┐рмдред рм╢рнАрм░рнНрм╖рмХ, рмЙрмкрм╢рнАрм░рнНрм╖рмХ рмПрммрмВ рмЕрмирнБрмЪрнНрмЫрнЗрмж рмЧрмармирмХрнБ рммрмЬрм╛рнЯ рм░рмЦрмирнНрмдрнБред",
    "Sanskrit": "рдЕрдзреЛрд▓рд┐рдЦрд┐рддрдВ рд╢реЛрдзрдкрддреНрд░рдВ рд╕рдВрд╕реНрдХреГрддреЗ рдЕрдиреБрд╡рд╛рджрдпрддреБред рдЕрдиреБрд╡рд╛рджрдГ рд╕реНрдкрд╖реНрдЯрдГ, рдпрдерд╛рд░реНрдердГ рд╡реИрдЬреНрдЮрд╛рдирд┐рдХрд╢рдмреНрджрд╛рд╡рд▓реНрдпрд╛ рдЪ рднрд╡реЗрддреНред рд╢реАрд░реНрд╖рдХрдореН, рдЙрдкрд╢реАрд░реНрд╖рдХрдореН рдЕрдиреБрдЪреНрдЫреЗрджрд░рдЪрдирд╛рдВ рдЪ рд╕рдВрд░рдХреНрд╖рддреБред",
    "Korean": "ыЛдьЭМ ьЧ░ъ╡м ыЕ╝ым╕ьЭД эХЬъ╡ньЦ┤ыбЬ ы▓ИьЧнэХШьД╕ьЪФ. ы▓ИьЧньЭА ыкЕэЩХэХШъ│а ьаХэЩХэХШый░ ъ│╝эХЩьаБ ьЪйьЦ┤ые╝ ьЬаьзАэХ┤ьХ╝ эХйыЛИыЛд. ьаЬыкй, ы╢АьаЬыкй ы░П ыЛиыЭ╜ ъ╡мьб░ые╝ ьЬаьзАэХШьД╕ьЪФ.",
    "Japanese": "ф╗еф╕ЛуБочаФчй╢шлЦцЦЗуВТцЧецЬмшкЮуБлч┐╗ши│уБЧуБжуБПуБауБХуБДуАВч┐╗ши│уБпцШОчв║уБзцнгчв║уБзуБВуВКуАБчзСхнжчЪДуБкчФишкЮуВТч╢нцМБуБЩуВЛх┐ЕшжБуБМуБВуВКуБ╛уБЩуАВшжЛхЗ║уБЧуАБх░ПшжЛхЗ║уБЧуАБцо╡шР╜цзЛщАауВТф┐ЭцМБуБЧуБжуБПуБауБХуБДуАВ",
    "Arabic": "┘В┘Е ╪и╪к╪▒╪м┘Е╪й ┘И╪▒┘В╪й ╪з┘Д╪и╪н╪л ╪з┘Д╪к╪з┘Д┘К╪й ╪е┘Д┘Й ╪з┘Д╪╣╪▒╪и┘К╪й. ┘К╪м╪и ╪г┘Ж ╪к┘Г┘И┘Ж ╪з┘Д╪к╪▒╪м┘Е╪й ┘И╪з╪╢╪н╪й ┘И╪п┘В┘К┘В╪й ┘И╪к╪н╪з┘Б╪╕ ╪╣┘Д┘Й ╪з┘Д┘Е╪╡╪╖┘Д╪н╪з╪к ╪з┘Д╪╣┘Д┘Е┘К╪й. ╪з┘Д╪н┘Б╪з╪╕ ╪╣┘Д┘Й ╪з┘Д╪╣┘Ж╪з┘И┘К┘Ж ┘И╪з┘Д╪╣┘Ж╪з┘И┘К┘Ж ╪з┘Д┘Б╪▒╪╣┘К╪й ┘И┘З┘К┘Г┘Д ╪з┘Д┘Б┘В╪▒╪й.",
    "French": "Traduisez le document de recherche suivant en fran├зais. La traduction doit ├кtre claire, pr├йcise et maintenir la terminologie scientifique. Pr├йserver les titres, sous-titres et la structure des paragraphes.",
    "German": "├Ьbersetzen Sie das folgende Forschungspapier ins Deutsche. Die ├Ьbersetzung sollte klar, pr├дzise und wissenschaftliche Terminologie beibehalten. Bewahren Sie die ├Ьberschriften, Unter├╝berschriften und Absatzstruktur.",
    "Spanish": "Traduzca el siguiente documento de investigaci├│n al espa├▒ol. La traducci├│n debe ser clara, precisa y mantener la terminolog├нa cient├нfica. Preservar los encabezados, subt├нtulos y estructura de p├бrrafos.",
    "Portuguese": "Traduza o seguinte artigo de pesquisa para portugu├кs. A tradu├з├гo deve ser clara, precisa e manter a terminologia cient├нfica. Preservar os t├нtulos, subt├нtulos e estrutura de par├бgrafos.",
    "Russian": "╨Я╨╡╤А╨╡╨▓╨╡╨┤╨╕╤В╨╡ ╤Б╨╗╨╡╨┤╤Г╤О╤Й╤Г╤О ╨╕╤Б╤Б╨╗╨╡╨┤╨╛╨▓╨░╤В╨╡╨╗╤М╤Б╨║╤Г╤О ╤А╨░╨▒╨╛╤В╤Г ╨╜╨░ ╤А╤Г╤Б╤Б╨║╨╕╨╣ ╤П╨╖╤Л╨║. ╨Я╨╡╤А╨╡╨▓╨╛╨┤ ╨┤╨╛╨╗╨╢╨╡╨╜ ╨▒╤Л╤В╤М ╤П╤Б╨╜╤Л╨╝, ╤В╨╛╤З╨╜╤Л╨╝ ╨╕ ╤Б╨╛╤Е╤А╨░╨╜╤П╤В╤М ╨╜╨░╤Г╤З╨╜╤Г╤О ╤В╨╡╤А╨╝╨╕╨╜╨╛╨╗╨╛╨│╨╕╤О. ╨б╨╛╤Е╤А╨░╨╜╤П╨╣╤В╨╡ ╨╖╨░╨│╨╛╨╗╨╛╨▓╨║╨╕, ╨┐╨╛╨┤╨╖╨░╨│╨╛╨╗╨╛╨▓╨║╨╕ ╨╕ ╤Б╤В╤А╤Г╨║╤В╤Г╤А╤Г ╨░╨▒╨╖╨░╤Ж╨╡╨▓.",
    "Chinese": "х░Жф╗еф╕ЛчаФчй╢шо║цЦЗч┐╗шпСцИРф╕нцЦЗуАВч┐╗шпСх║Фц╕ЕцЩ░уАБхЗЖчбох╣╢ф┐ЭцМБчзСхнжцЬпшпнуАВф┐ЭчХЩцаЗщвШуАБхЙпцаЗщвШхТМцо╡шР╜ч╗УцЮДуАВ",
    "Vietnamese": "Dс╗Лch b├аi nghi├кn cс╗йu sau sang tiс║┐ng Viс╗Зt. Bс║гn dс╗Лch phс║гi r├╡ r├аng, ch├нnh x├бc v├а duy tr├м thuс║нt ngс╗п khoa hс╗Нc. Giс╗п nguy├кn ti├кu ─Сс╗Б, ti├кu ─Сс╗Б phс╗е v├а cс║еu tr├║c ─Сoс║бn v─Гn.",
    "Thai": "р╣Бр╕Ыр╕ер╣Ар╕нр╕Бр╕кр╕▓р╕гр╕зр╕┤р╕Ир╕▒р╕вр╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в р╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Хр╣Йр╕нр╕Зр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З р╣Бр╕ер╕░р╕гр╕▒р╕Бр╕йр╕▓р╕ир╕▒р╕Юр╕Чр╣Мр╕Чр╕▓р╕Зр╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣М р╣Ар╕Бр╣Зр╕Ър╕гр╕▒р╕Бр╕йр╕▓р╕лр╕▒р╕зр╕Вр╣Йр╕н р╕лр╕▒р╕зр╕Вр╣Йр╕нр╕вр╣Ир╕нр╕в р╣Бр╕ер╕░р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕вр╣Ир╕нр╕лр╕Щр╣Йр╕▓",
    "Indonesian": "Terjemahkan makalah penelitian berikut ke dalam Bahasa Indonesia. Terjemahan harus jelas, akurat, dan mempertahankan terminologi ilmiah. Pertahankan judul, subjudul, dan struktur paragraf.",
    "Turkish": "A┼Яa─Я─▒daki ara┼Яt─▒rma makalesini T├╝rk├зeye ├зevirin. ├Зeviri a├з─▒k, do─Яru ve bilimsel terminolojiyi korumal─▒d─▒r. Ba┼Яl─▒klar─▒, alt ba┼Яl─▒klar─▒ ve paragraf yap─▒s─▒n─▒ koruyun.",
    "Polish": "Przet┼Вumacz poni┼╝szy artyku┼В badawczy na j─Щzyk polski. T┼Вumaczenie powinno by─З jasne, dok┼Вadne i zachowywa─З terminologi─Щ naukow─Е. Zachowaj nag┼В├│wki, podtytu┼Вy i struktur─Щ akapit├│w.",
    "Ukrainian": "╨Я╨╡╤А╨╡╨║╨╗╨░╨┤╤Ц╤В╤М ╨╜╨░╤Б╤В╤Г╨┐╨╜╤Г ╨┤╨╛╤Б╨╗╤Ц╨┤╨╜╨╕╤Ж╤М╨║╤Г ╤А╨╛╨▒╨╛╤В╤Г ╤Г╨║╤А╨░╤Ч╨╜╤Б╤М╨║╨╛╤О ╨╝╨╛╨▓╨╛╤О. ╨Я╨╡╤А╨╡╨║╨╗╨░╨┤ ╨╝╨░╤Ф ╨▒╤Г╤В╨╕ ╤З╤Ц╤В╨║╨╕╨╝, ╤В╨╛╤З╨╜╨╕╨╝ ╤Ц ╨╖╨▒╨╡╤А╤Ц╨│╨░╤В╨╕ ╨╜╨░╤Г╨║╨╛╨▓╤Г ╤В╨╡╤А╨╝╤Ц╨╜╨╛╨╗╨╛╨│╤Ц╤О. ╨Ч╨▒╨╡╤А╤Ц╨│╨░╨╣╤В╨╡ ╨╖╨░╨│╨╛╨╗╨╛╨▓╨║╨╕, ╨┐╤Ц╨┤╨╖╨░╨│╨╛╨╗╨╛╨▓╨║╨╕ ╤В╨░ ╤Б╤В╤А╤Г╨║╤В╤Г╤А╤Г ╨░╨▒╨╖╨░╤Ж╤Ц╨▓.",
    "Dutch": "Vertaal het volgende onderzoeksdocument naar het Nederlands. De vertaling moet duidelijk, nauwkeurig zijn en wetenschappelijke terminologie behouden. Behoud de koppen, subkoppen en alineastructuur.",
    "Italian": "Traduci il seguente documento di ricerca in italiano. La traduzione deve essere chiara, precisa e mantenere la terminologia scientifica. Preservare i titoli, i sottotitoli e la struttura dei paragrafi.",
    "Greek": "╬Ь╬╡╧Д╬▒╧Ж╧Б╬м╧Г╧Д╬╡ ╧Д╬╖╬╜ ╧А╬▒╧Б╬▒╬║╬м╧Д╧Й ╬╡╧Б╬╡╧Е╬╜╬╖╧Д╬╣╬║╬о ╬╡╧Б╬│╬▒╧Г╬п╬▒ ╧Г╧Д╬▒ ╬╡╬╗╬╗╬╖╬╜╬╣╬║╬м. ╬Ч ╬╝╬╡╧Д╬м╧Ж╧Б╬▒╧Г╬╖ ╧А╧Б╬н╧А╬╡╬╣ ╬╜╬▒ ╬╡╬п╬╜╬▒╬╣ ╧Г╬▒╧Ж╬о╧В, ╬▒╬║╧Б╬╣╬▓╬о╧В ╬║╬▒╬╣ ╬╜╬▒ ╬┤╬╣╬▒╧Д╬╖╧Б╬╡╬п ╧Д╬╖╬╜ ╬╡╧А╬╣╧Г╧Д╬╖╬╝╬┐╬╜╬╣╬║╬о ╬┐╧Б╬┐╬╗╬┐╬│╬п╬▒. ╬Ф╬╣╬▒╧Д╬╖╧Б╬о╧Г╧Д╬╡ ╧Д╬┐╧Е╧В ╧Д╬п╧Д╬╗╬┐╧Е╧В, ╧Д╬┐╧Е╧В ╧Е╧А╧М╧Д╬╣╧Д╬╗╬┐╧Е╧В ╬║╬▒╬╣ ╧Д╬╖ ╬┤╬┐╬╝╬о ╧Д╧Й╬╜ ╧А╬▒╧Б╬▒╬│╧Б╬м╧Ж╧Й╬╜.",
    "Hebrew": "╫к╫и╫Т╫Э ╫Р╫к ╫Ю╫Р╫Ю╫и ╫Ф╫Ю╫Ч╫з╫и ╫Ф╫С╫Р ╫Ь╫в╫С╫и╫Щ╫к. ╫Ф╫к╫и╫Т╫Х╫Э ╫ж╫и╫Щ╫Ъ ╫Ь╫Ф╫Щ╫Х╫к ╫С╫и╫Х╫и, ╫Ю╫У╫Х╫Щ╫з ╫Х╫Ь╫й╫Ю╫Х╫и ╫в╫Ь ╫Ш╫и╫Ю╫Щ╫а╫Х╫Ь╫Х╫Т╫Щ╫Ф ╫Ю╫У╫в╫Щ╫к. ╫й╫Ю╫Х╫и ╫в╫Ь ╫Ы╫Х╫к╫и╫Х╫к, ╫Ы╫Х╫к╫и╫Х╫к ╫Ю╫й╫а╫Ф ╫Х╫Ю╫С╫а╫Ф ╫д╫б╫з╫Р╫Х╫к.",
    "Persian": "┘Е┘В╪з┘Д┘З ╪к╪н┘В█М┘В╪з╪к█М ╪▓█М╪▒ ╪▒╪з ╪и┘З ┘Б╪з╪▒╪│█М ╪к╪▒╪м┘Е┘З ┌й┘Ж█М╪п. ╪к╪▒╪м┘Е┘З ╪и╪з█М╪п ┘И╪з╪╢╪н╪М ╪п┘В█М┘В ┘И ╪з╪╡╪╖┘Д╪з╪н╪з╪к ╪╣┘Д┘Е█М ╪▒╪з ╪н┘Б╪╕ ┌й┘Ж╪п. ╪╣┘Ж╪з┘И█М┘Ж╪М ╪▓█М╪▒╪╣┘Ж┘И╪з┘ЖтАМ┘З╪з ┘И ╪│╪з╪о╪к╪з╪▒ ┘╛╪з╪▒╪з┌п╪▒╪з┘Б ╪▒╪з ╪н┘Б╪╕ ┌й┘Ж█М╪п.",
    "Swedish": "├Цvers├дtt f├╢ljande forskningsdokument till svenska. ├Цvers├дttningen ska vara tydlig, korrekt och beh├еlla vetenskaplig terminologi. Bevara rubriker, underrubriker och styckestruktur.",
    "Norwegian": "Oversett f├╕lgende forskningsdokument til norsk. Oversettelsen skal v├жre tydelig, n├╕yaktig og beholde vitenskapelig terminologi. Bevar overskrifter, underoverskrifter og avsnittsstruktur.",
    "Danish": "Overs├жt f├╕lgende forskningsdokument til dansk. Overs├жttelsen skal v├жre klar, pr├жcis og bevare videnskabelig terminologi. Bevar overskrifter, underoverskrifter og afsnitsstruktur.",
    "Finnish": "K├д├дnn├д seuraava tutkimusasiakirja suomeksi. K├д├дnn├╢ksen tulee olla selke├д, tarkka ja s├дilytt├д├д tieteellinen terminologia. S├дilyt├д otsikot, alaotsikot ja kappaleiden rakenne.",
    "Czech": "P┼Щelo┼╛te n├бsleduj├нc├н v├╜zkumn├╜ dokument do ─Нe┼бtiny. P┼Щeklad mus├н b├╜t jasn├╜, p┼Щesn├╜ a zachovat v─Ыdeckou terminologii. Zachovejte nadpisy, podnadpisy a strukturu odstavc┼п.",
    "Hungarian": "Ford├нtsa le a k├╢vetkez┼С kutat├бsi dokumentumot magyarra. A ford├нt├бsnak vil├бgosnak, pontosnak kell lennie ├йs meg kell ┼Сriznie a tudom├бnyos terminol├│gi├бt. Meg┼Сrizni a c├нmsorokat, alc├нmsorokat ├йs a bekezd├йsek szerkezet├йt.",
    "Romanian": "Traduce╚Ыi urm─Гtorul document de cercetare ├оn limba rom├вn─Г. Traducerea trebuie s─Г fie clar─Г, precis─Г ╚Щi s─Г p─Гstreze terminologia ╚Щtiin╚Ыific─Г. P─Гstra╚Ыi titlurile, subtitlurile ╚Щi structura paragrafelor.",
    "Bulgarian": "╨Я╤А╨╡╨▓╨╡╨┤╨╡╤В╨╡ ╤Б╨╗╨╡╨┤╨╜╨╕╤П ╨╕╨╖╤Б╨╗╨╡╨┤╨╛╨▓╨░╤В╨╡╨╗╤Б╨║╨╕ ╨┤╨╛╨║╤Г╨╝╨╡╨╜╤В ╨╜╨░ ╨▒╤К╨╗╨│╨░╤А╤Б╨║╨╕ ╨╡╨╖╨╕╨║. ╨Я╤А╨╡╨▓╨╛╨┤╤К╤В ╤В╤А╤П╨▒╨▓╨░ ╨┤╨░ ╨╡ ╤П╤Б╨╡╨╜, ╤В╨╛╤З╨╡╨╜ ╨╕ ╨┤╨░ ╨╖╨░╨┐╨░╨╖╨▓╨░ ╨╜╨░╤Г╤З╨╜╨░╤В╨░ ╤В╨╡╤А╨╝╨╕╨╜╨╛╨╗╨╛╨│╨╕╤П. ╨Ч╨░╨┐╨░╨╖╨╡╤В╨╡ ╨╖╨░╨│╨╗╨░╨▓╨╕╤П╤В╨░, ╨┐╨╛╨┤╨╖╨░╨│╨╗╨░╨▓╨╕╤П╤В╨░ ╨╕ ╤Б╤В╤А╤Г╨║╤В╤Г╤А╨░╤В╨░ ╨╜╨░ ╨┐╨░╤А╨░╨│╤А╨░╤Д╨╕╤В╨╡.",
    "Croatian": "Prevedite sljede─Зi istra┼╛iva─Нki dokument na hrvatski jezik. Prijevod mora biti jasan, to─Нan i zadr┼╛ati znanstvenu terminologiju. Zadr┼╛ite naslove, podnaslove i strukturu odlomaka.",
    "Serbian": "╨Я╤А╨╡╨▓╨╡╨┤╨╕╤В╨╡ ╤Б╨╗╨╡╨┤╨╡╤Ы╨╕ ╨╕╤Б╤В╤А╨░╨╢╨╕╨▓╨░╤З╨║╨╕ ╨┤╨╛╨║╤Г╨╝╨╡╨╜╤В ╨╜╨░ ╤Б╤А╨┐╤Б╨║╨╕ ╤Ш╨╡╨╖╨╕╨║. ╨Я╤А╨╡╨▓╨╛╨┤ ╨╝╨╛╤А╨░ ╨▒╨╕╤В╨╕ ╤Ш╨░╤Б╨░╨╜, ╤В╨░╤З╨░╨╜ ╨╕ ╨╖╨░╨┤╤А╨╢╨░╤В╨╕ ╨╜╨░╤Г╤З╨╜╤Г ╤В╨╡╤А╨╝╨╕╨╜╨╛╨╗╨╛╨│╨╕╤Ш╤Г. ╨Ч╨░╨┤╤А╨╢╨╕╤В╨╡ ╨╜╨░╤Б╨╗╨╛╨▓╨╡, ╨┐╨╛╨┤╨╜╨░╤Б╨╗╨╛╨▓╨╡ ╨╕ ╤Б╤В╤А╤Г╨║╤В╤Г╤А╤Г ╨┐╨░╤Б╤Г╤Б╨░.",
    "Slovak": "Prelo┼╛te nasleduj├║ci v├╜skumn├╜ dokument do sloven─Нiny. Preklad mus├н by┼е jasn├╜, presn├╜ a zachova┼е vedeck├║ terminol├│giu. Zachovajte nadpisy, podnadpisy a ┼бtrukt├║ru odsekov.",
    "Slovenian": "Prevedite naslednji raziskovalni dokument v sloven┼б─Нino. Prevajalec mora biti jasen, natan─Нen in ohranjati znanstveno terminologijo. Ohranite naslove, podnaslove in strukturo odstavkov.",
    "Estonian": "T├╡lkige j├дrgmine uurimisdokument eesti keelde. T├╡lge peab olema selge, t├дpne ja s├дilitama teadusliku terminoloogia. S├дilitage pealkirjad, alapealkirjad ja l├╡ikude struktuur.",
    "Latvian": "Tulkojiet ┼бo p─Уtniec─лbas dokumentu latvie┼бu valod─Б. Tulkojumam j─Бb┼лt skaidram, prec─лzam un j─Бsaglab─Б zin─Бtnisk─Б terminolo─гija. Saglab─Бjiet virsrakstus, apak┼бvirsrakstus un rindkopu strukt┼лru.",
    "Lithuanian": "I┼бverskite ┼б─п mokslin─п dokument─Е ─п lietuvi┼│ kalb─Е. Vertimas turi b┼лti ai┼бkus, tikslus ir i┼бlaikyti mokslin─Щ terminologij─Е. I┼бlaikykite antra┼бtes, paantra┼бtes ir pastraip┼│ strukt┼лr─Е.",
    "Malay": "Terjemahkan dokumen penyelidikan berikut ke dalam Bahasa Melayu. Terjemahan mestilah jelas, tepat dan mengekalkan terminologi saintifik. Mengekalkan tajuk, subtajuk dan struktur perenggan.",
    "Tagalog": "Isalin ang sumusunod na dokumento ng pananaliksik sa Tagalog. Ang pagsasalin ay dapat malinaw, tumpak at mapanatili ang siyentipikong terminolohiya. Panatilihin ang mga pamagat, subpamagat at istruktura ng talata.",
    "Swahili": "Tafsiri nyaraka zifuatazo za utafiti kwa Kiswahili. Tafsiri inapaswa kuwa wazi, sahihi na kudumisha istilahi za kisayansi. Dumisha vichwa, vichwa vidogo na muundo wa aya."
}

# Streaming callback handler
class StreamHandler(BaseCallbackHandler):
    def __init__(self, container, initial_text=""):
        self.container = container
        self.text = initial_text
        self.run_id_ignore_token = None
    
    def on_llm_new_token(self, token: str, **kwargs):
        self.text += token
        self.container.markdown(self.text)

# Initialize the ChatOpenAI model - base instance for caching
@st.cache_resource
def get_base_chat_model(api_key):
    return ChatOpenAI(
        api_key=api_key,
        base_url="https://api.two.ai/v2",
        model="sutra-v2",
        temperature=0.3,  # Lower temperature for more accurate translations
    )

# Create a streaming version of the model with callback handler
def get_streaming_chat_model(api_key, callback_handler=None):
    # Create a new instance with streaming enabled
    return ChatOpenAI(
        api_key=api_key,
        base_url="https://api.two.ai/v2",
        model="sutra-v2",
        temperature=0.3,  # Lower temperature for more accurate translations
        streaming=True,
        callbacks=[callback_handler] if callback_handler else None
    )

# Function to extract text from PDF
def extract_text_from_pdf(pdf_file):
    pdf_reader = PyPDF2.PdfReader(pdf_file)
    text = ""
    for page_num in range(len(pdf_reader.pages)):
        text += pdf_reader.pages[page_num].extract_text() + "\n\n"
    return text

# Function to extract text from DOCX
def extract_text_from_docx(docx_file):
    doc = docx.Document(docx_file)
    text = ""
    for para in doc.paragraphs:
        text += para.text + "\n"
    return text

# Function to extract text from TXT
def extract_text_from_txt(txt_file):
    return txt_file.getvalue().decode("utf-8")

# Function to chunk text for processing
def chunk_text(text, max_chunk_size=5000):
    """Split text into chunks of max_chunk_size characters,
    trying to preserve paragraph integrity."""
    paragraphs = text.split("\n\n")
    chunks = []
    current_chunk = ""
    
    for paragraph in paragraphs:
        # If adding this paragraph would exceed max size, save current chunk and start a new one
        if len(current_chunk) + len(paragraph) > max_chunk_size:
            if current_chunk:  # Only append if current_chunk is not empty
                chunks.append(current_chunk)
            current_chunk = paragraph + "\n\n"
        else:
            current_chunk += paragraph + "\n\n"
    
    # Don't forget the last chunk
    if current_chunk:
        chunks.append(current_chunk)
    
    return chunks

# Function to translate text using Sutra LLM
def translate_text(text, language, api_key, response_container):
    # Create stream handler
    stream_handler = StreamHandler(response_container)
    
    # Get streaming model with handler
    chat = get_streaming_chat_model(api_key, stream_handler)
    
    # Create message with translation instruction
    instruction = translation_instructions.get(language, f"Translate the following research paper into {language}. The translation should be clear, accurate, and maintain scientific terminology. Preserve the headings, subheadings, and paragraph structure.")
    
    message = f"{instruction}\n\n{text}"
    
    # Generate streaming response
    messages = [HumanMessage(content=message)]
    
    response = chat.invoke(messages)
    return response.content

# Sidebar for language selection and API key
st.sidebar.image("https://framerusercontent.com/images/3Ca34Pogzn9I3a7uTsNSlfs9Bdk.png", use_container_width=True)
with st.sidebar:
    st.title("ЁЯУЪ Research Paper Translator")
    
    # API Key section
    st.markdown("### API Key")
    st.markdown("Get your free API key from [Sutra API](https://www.two.ai/sutra/api)")
    api_key = st.text_input("Enter your Sutra API Key:", type="password")
    
    # Language selector
    target_language = st.selectbox("Select target language:", languages)
    
    st.divider()
    
    # About section
    st.markdown("### About Sutra LLM")
    st.markdown("Sutra is a multilingual model supporting 50+ languages with high-quality responses, making it ideal for academic translations.")
    
    # Disclaimer
    st.markdown("### Disclaimer")
    st.markdown("This tool uses AI for translation. While it strives for accuracy, some technical or specialized terms may require review by subject matter experts.")

# Main content
st.markdown('<h1><img src="https://cdn.pixabay.com/animation/2023/06/13/15/13/15-13-33-168_512.gif" width="70" height="70" style="vertical-align: middle;"> Research Paper Translator - Sutra LLM</h1>', unsafe_allow_html=True)
st.markdown(f"Upload a research paper and translate it into **{target_language}**. Supports PDF, DOCX, and TXT formats.")

# File uploader
uploaded_file = st.file_uploader("Upload your research paper", type=["pdf", "docx", "txt"])

# Process the file
if uploaded_file is not None:
    # Extract text based on file type
    with st.spinner("Extracting text from document..."):
        if uploaded_file.name.endswith('.pdf'):
            text = extract_text_from_pdf(uploaded_file)
        elif uploaded_file.name.endswith('.docx'):
            text = extract_text_from_docx(uploaded_file)
        elif uploaded_file.name.endswith('.txt'):
            text = extract_text_from_txt(uploaded_file)
        else:
            st.error("Unsupported file format")
            text = None
    
    if text:
        # Display a sample of the extracted text
        with st.expander("Preview Extracted Text"):
            st.text(text[:1000] + "...")
        
        # Translation section
        st.markdown(f"## Translation to {target_language}")
        
        # Check if API key is provided
        if not api_key:
            st.error("Please enter your Sutra API key in the sidebar.")
        else:
            translate_button = st.button("Start Translation")
            
            if translate_button:
                # Split text into chunks for processing
                chunks = chunk_text(text)
                
                # Translation progress
                progress_bar = st.progress(0)
                translated_text_full = ""
                
                # Container for translated text
                translated_output = st.container()
                
                # Process each chunk
                for i, chunk in enumerate(chunks):
                    st.subheader(f"Translating part {i+1} of {len(chunks)}")
                    
                    # Create container for this chunk's translation
                    chunk_container = st.empty()
                    
                    # Translate chunk
                    translated_chunk = translate_text(chunk, target_language, api_key, chunk_container)
                    
                    # Append to full translation
                    translated_text_full += translated_chunk + "\n\n"
                    
                    # Update progress
                    progress_bar.progress((i + 1) / len(chunks))
                
                # Final output section
                st.markdown("## Completed Translation")
                st.markdown(translated_text_full)
                
                # Download option
                st.download_button(
                    label="Download Translated Paper",
                    data=translated_text_full,
                    file_name=f"translated_{target_language}_{uploaded_file.name.split('.')[0]}.txt",
                    mime="text/plain"
                )
else:
    # Placeholder example when no file is uploaded
    st.info("Please upload a research paper to begin translation.")
    
    # Example of what the tool does
    st.markdown("### How it works")
    st.markdown("""
    1. Upload your research paper (PDF, DOCX, or TXT format)
    2. Select your target Indian language
    3. Click 'Start Translation'
    4. Review and download the translated paper
    
    The tool processes large documents by breaking them into manageable chunks while preserving the document structure.
    """)
